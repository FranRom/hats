import React, { useState } from "react";
import "../../styles/Vulnerability/Description.scss";
import { AccordionContext } from "./VulnerabilityAccordion";
import ReactMde from "react-mde";
import * as Showdown from "showdown";

interface IProps {
  data: {
    title: string,
    description: string
  }
}

type DescriptionTab = "write" | "preview";

const converter = new Showdown.Converter({
  tables: true,
  simplifiedAutoLink: true,
  strikethrough: true,
  tasklists: true
});

export default function Description(props: IProps) {
  const [title, setTitle] = useState(props.data.title);
  const [selectedTab, setSelectedTab] = React.useState<DescriptionTab>("write");
  const [description, setDescription] = useState(props.data.description);
  const { submitCard } = React.useContext(AccordionContext);

  return <div className="description-wrapper">
    <input type="text" placeholder="Title" onChange={(e) => setTitle(e.target.value)} value={title} />
    <ReactMde
      value={description}
      onChange={setDescription}
      selectedTab={selectedTab}
      onTabChange={setSelectedTab}
      generateMarkdownPreview={markdown =>
        Promise.resolve(converter.makeHtml(markdown))
      } />

    <button disabled={title === "" || description === ""} onClick={() => submitCard(2, { title: title, description: description })}>SUBMIT NEW VULNERBILITY</button>
  </div>
}
